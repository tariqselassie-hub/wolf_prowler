<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wolf Prowler - Scent Trails</title>
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.tailwindcss.com https://unpkg.com 'unsafe-inline'; style-src 'self' https://cdn.tailwindcss.com 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' http://localhost:8080 https://api.wolfprowler.com; font-src 'self' https: data:;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- External Resources -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        :root {
            --primary: #8b5cf6;
            --primary-dark: #7c3aed;
            --secondary: #4f46e5;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --light: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
        }
        
        body { 
            font-family: 'Inter', sans-serif;
            background: #0f172a;
        }
        
        .glass-morphism {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .scent-trail {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            animation: fadeOut 3s ease-out forwards;
        }
        
        @keyframes fadeOut {
            0% {
                opacity: 0.8;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(2);
            }
        }
        
        .pack-member {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .pack-member:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.6);
        }
        
        .pack-member.alpha {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border: 3px solid #f59e0b;
        }
        
        .pack-member.beta {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: 3px solid #3b82f6;
        }
        
        .pack-member.omega {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            border: 3px solid #8b5cf6;
        }
        
        .territory-map {
            position: relative;
            background: radial-gradient(ellipse at center, rgba(139, 92, 246, 0.1) 0%, rgba(15, 23, 42, 0.8) 70%);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 20px;
            overflow: hidden;
        }
        
        .data-flow-line {
            stroke: #8b5cf6;
            stroke-width: 2;
            fill: none;
            stroke-dasharray: 5, 5;
            animation: flowAnimation 2s linear infinite;
        }
        
        @keyframes flowAnimation {
            0% {
                stroke-dashoffset: 0;
            }
            100% {
                stroke-dashoffset: -10;
            }
        }
        
        .nav-item {
            transition: all 0.2s ease;
        }
        
        .nav-item:hover {
            background: rgba(139, 92, 246, 0.1);
            color: #8b5cf6;
        }
        
        .metric-card {
            transition: all 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.15);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="glass-morphism border-b border-gray-700">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-6">
                    <div class="flex items-center space-x-2">
                        <i data-lucide="footprints" class="w-6 h-6 text-purple-400"></i>
                        <span class="text-xl font-bold bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">Scent Trails</span>
                    </div>
                    <div class="hidden md:flex space-x-1">
                        <a href="/nav" class="nav-item px-3 py-2 rounded-lg text-sm">Dashboard</a>
                        <a href="/static/network_map.html" class="nav-item px-3 py-2 rounded-lg text-sm">Network Map</a>
                        <a href="/static/p2p.html" class="nav-item px-3 py-2 rounded-lg text-sm">P2P Chat</a>
                        <a href="/static/wolf_den.html" class="nav-item px-3 py-2 rounded-lg text-sm">Wolf Den</a>
                        <a href="/static/wolf_howl.html" class="nav-item px-3 py-2 rounded-lg text-sm">Wolf Howl</a>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="toggleScentVisualization()" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm transition-colors">
                        <i data-lucide="eye" class="w-4 h-4 inline mr-2"></i>Toggle Trails
                    </button>
                    <button onclick="clearScentTrails()" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm transition-colors">
                        <i data-lucide="trash-2" class="w-4 h-4 inline mr-2"></i>Clear Trails
                    </button>
                    <a href="/logout" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm transition-colors">
                        <i data-lucide="log-out" class="w-4 h-4 inline mr-2"></i>Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold mb-2">Scent Trail Visualization</h1>
            <p class="text-gray-400">Visualize network data flow and communication patterns between pack members</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Territory Map -->
            <div class="lg:col-span-3">
                <div class="glass-morphism rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-semibold flex items-center">
                            <i data-lucide="map" class="w-5 h-5 mr-2 text-purple-400"></i>
                            Territory Map
                        </h2>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-gray-400">Active Trails:</span>
                            <span id="active-trails-count" class="text-sm font-bold text-purple-400">0</span>
                        </div>
                    </div>
                    
                    <div id="territory-map" class="territory-map h-96 relative">
                        <!-- Pack members will be positioned here dynamically -->
                        <svg id="flow-svg" class="absolute inset-0 w-full h-full pointer-events-none">
                            <!-- Data flow lines will be drawn here -->
                        </svg>
                    </div>
                    
                    <div class="mt-4 flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center">
                                <div class="w-4 h-4 bg-yellow-500 rounded-full mr-2"></div>
                                <span class="text-sm">Alpha</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-4 bg-blue-500 rounded-full mr-2"></div>
                                <span class="text-sm">Beta</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-4 bg-purple-500 rounded-full mr-2"></div>
                                <span class="text-sm">Omega</span>
                            </div>
                        </div>
                        <div class="text-sm text-gray-400">
                            Trail Intensity: <span id="trail-intensity">Medium</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="space-y-4">
                <div class="glass-morphism rounded-xl p-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i data-lucide="sliders" class="w-5 h-5 mr-2 text-purple-400"></i>
                        Trail Settings
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Trail Duration</label>
                            <input type="range" id="trail-duration" min="1" max="10" value="3" class="w-full">
                            <div class="text-xs text-gray-400 mt-1">
                                <span id="duration-value">3</span> seconds
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Trail Color</label>
                            <select id="trail-color" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2">
                                <option value="purple">Purple (Default)</option>
                                <option value="blue">Blue</option>
                                <option value="green">Green</option>
                                <option value="yellow">Yellow</option>
                                <option value="red">Red</option>
                                <option value="rainbow">Rainbow</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Data Types</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" id="show-howls" checked class="mr-2">
                                    <span class="text-sm">Howl Messages</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="show-security" checked class="mr-2">
                                    <span class="text-sm">Security Events</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="show-vault" checked class="mr-2">
                                    <span class="text-sm">Vault Access</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="show-p2p" checked class="mr-2">
                                    <span class="text-sm">P2P Traffic</span>
                                </label>
                            </div>
                        </div>
                        
                        <button onclick="generateMockTraffic()" class="w-full px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition-colors">
                            <i data-lucide="play" class="w-4 h-4 inline mr-2"></i>Generate Mock Traffic
                        </button>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="glass-morphism rounded-xl p-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i data-lucide="bar-chart-2" class="w-5 h-5 mr-2 text-purple-400"></i>
                        Trail Statistics
                    </h2>
                    
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-400">Total Messages</span>
                            <span id="total-messages" class="text-sm font-bold">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-400">Active Pack Members</span>
                            <span id="active-members" class="text-sm font-bold">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-400">Peak Activity</span>
                            <span id="peak-activity" class="text-sm font-bold">0 msg/s</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-400">Territory Coverage</span>
                            <span id="territory-coverage" class="text-sm font-bold">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="glass-morphism rounded-xl p-6 mt-6">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <i data-lucide="activity" class="w-5 h-5 mr-2 text-purple-400"></i>
                Recent Scent Activity
            </h2>
            
            <div id="recent-activity" class="space-y-2 max-h-64 overflow-y-auto">
                <!-- Activity items will be populated here -->
            </div>
        </div>
    </main>

    <script>
        // Initialize lucide icons
        lucide.createIcons();

        // Global state
        let scentVisualizationEnabled = true;
        let activeTrails = 0;
        let totalMessages = 0;
        let peakActivity = 0;
        let packMembers = [];
        let activityLog = [];

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            initializePackMembers();
            setupEventListeners();
            startRealTimeUpdates();
            loadRecentActivity();
        });

        function initializePackMembers() {
            const map = document.getElementById('territory-map');
            const mapRect = map.getBoundingClientRect();
            
            // Create pack members with different roles
            packMembers = [
                { id: 'alpha-1', name: 'Alpha', role: 'alpha', x: 50, y: 50 },
                { id: 'beta-1', name: 'Beta1', role: 'beta', x: 150, y: 100 },
                { id: 'beta-2', name: 'Beta2', role: 'beta', x: 250, y: 150 },
                { id: 'omega-1', name: 'Omega1', role: 'omega', x: 100, y: 200 },
                { id: 'omega-2', name: 'Omega2', role: 'omega', x: 300, y: 50 },
                { id: 'omega-3', name: 'Omega3', role: 'omega', x: 200, y: 250 }
            ];
            
            packMembers.forEach(member => {
                const memberEl = document.createElement('div');
                memberEl.className = `pack-member ${member.role}`;
                memberEl.id = member.id;
                memberEl.style.left = `${member.x}px`;
                memberEl.style.top = `${member.y}px`;
                memberEl.innerHTML = `
                    <div class="text-white text-xs">
                        <div>${member.name}</div>
                    </div>
                `;
                memberEl.onclick = () => showMemberDetails(member);
                map.appendChild(memberEl);
            });
            
            updateActiveMembers();
        }

        function setupEventListeners() {
            // Trail duration slider
            const durationSlider = document.getElementById('trail-duration');
            durationSlider.addEventListener('input', (e) => {
                document.getElementById('duration-value').textContent = e.target.value;
            });
            
            // Data type checkboxes
            ['show-howls', 'show-security', 'show-vault', 'show-p2p'].forEach(id => {
                document.getElementById(id).addEventListener('change', updateVisualization);
            });
        }

        function createScentTrail(fromMember, toMember, dataType, intensity = 'medium') {
            if (!scentVisualizationEnabled) return;
            
            const map = document.getElementById('territory-map');
            const fromEl = document.getElementById(fromMember.id);
            const toEl = document.getElementById(toMember.id);
            
            if (!fromEl || !toEl) return;
            
            const fromRect = fromEl.getBoundingClientRect();
            const toRect = toEl.getBoundingClientRect();
            const mapRect = map.getBoundingClientRect();
            
            const fromX = fromRect.left - mapRect.left + fromRect.width / 2;
            const fromY = fromRect.top - mapRect.top + fromRect.height / 2;
            const toX = toRect.left - mapRect.left + toRect.width / 2;
            const toY = toRect.top - mapRect.top + toRect.height / 2;
            
            // Create visual trail
            const trail = document.createElement('div');
            trail.className = 'scent-trail';
            
            const color = getTrailColor(dataType);
            const size = getTrailSize(intensity);
            
            trail.style.left = `${fromX - size/2}px`;
            trail.style.top = `${fromY - size/2}px`;
            trail.style.width = `${size}px`;
            trail.style.height = `${size}px`;
            trail.style.background = `radial-gradient(circle, ${color} 0%, transparent 70%)`;
            
            const duration = parseInt(document.getElementById('trail-duration').value) * 1000;
            trail.style.animationDuration = `${duration}ms`;
            
            map.appendChild(trail);
            activeTrails++;
            updateActiveTrails();
            
            // Create animated line
            createFlowLine(fromX, fromY, toX, toY, color);
            
            // Remove trail after animation
            setTimeout(() => {
                trail.remove();
                activeTrails--;
                updateActiveTrails();
            }, duration);
            
            // Log activity
            logActivity(fromMember.name, toMember.name, dataType);
        }

        function createFlowLine(fromX, fromY, toX, toY, color) {
            const svg = document.getElementById('flow-svg');
            
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', fromX);
            line.setAttribute('y1', fromY);
            line.setAttribute('x2', toX);
            line.setAttribute('y2', toY);
            line.setAttribute('class', 'data-flow-line');
            line.style.stroke = color;
            
            svg.appendChild(line);
            
            // Remove line after animation
            setTimeout(() => {
                line.remove();
            }, 2000);
        }

        function getTrailColor(dataType) {
            const colorMap = {
                'howl': '#8b5cf6',
                'security': '#ef4444',
                'vault': '#10b981',
                'p2p': '#3b82f6'
            };
            
            const selectedColor = document.getElementById('trail-color').value;
            if (selectedColor === 'rainbow') {
                const colors = ['#8b5cf6', '#3b82f6', '#10b981', '#f59e0b', '#ef4444'];
                return colors[Math.floor(Math.random() * colors.length)];
            }
            
            return colorMap[dataType] || selectedColor;
        }

        function getTrailSize(intensity) {
            const sizeMap = {
                'low': 20,
                'medium': 30,
                'high': 40
            };
            return sizeMap[intensity] || 30;
        }

        function toggleScentVisualization() {
            scentVisualizationEnabled = !scentVisualizationEnabled;
            const button = event.target.closest('button');
            
            if (scentVisualizationEnabled) {
                button.innerHTML = '<i data-lucide="eye" class="w-4 h-4 inline mr-2"></i>Toggle Trails';
                button.className = 'px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm transition-colors';
            } else {
                button.innerHTML = '<i data-lucide="eye-off" class="w-4 h-4 inline mr-2"></i>Toggle Trails';
                button.className = 'px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg text-sm transition-colors';
            }
        }

        function clearScentTrails() {
            const map = document.getElementById('territory-map');
            const trails = map.querySelectorAll('.scent-trail');
            const lines = document.querySelectorAll('.data-flow-line');
            
            trails.forEach(trail => trail.remove());
            lines.forEach(line => line.remove());
            
            activeTrails = 0;
            updateActiveTrails();
        }

        function generateMockTraffic() {
            const dataTypes = ['howl', 'security', 'vault', 'p2p'];
            const intensities = ['low', 'medium', 'high'];
            
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const fromMember = packMembers[Math.floor(Math.random() * packMembers.length)];
                    const toMember = packMembers[Math.floor(Math.random() * packMembers.length)];
                    const dataType = dataTypes[Math.floor(Math.random() * dataTypes.length)];
                    const intensity = intensities[Math.floor(Math.random() * intensities.length)];
                    
                    if (fromMember.id !== toMember.id) {
                        createScentTrail(fromMember, toMember, dataType, intensity);
                        totalMessages++;
                        updateStatistics();
                    }
                }, i * 200);
            }
        }

        function updateStatistics() {
            document.getElementById('total-messages').textContent = totalMessages;
            document.getElementById('peak-activity').textContent = `${peakActivity} msg/s`;
            
            // Calculate territory coverage based on active pack members
            const coverage = Math.min(100, (packMembers.length / 6) * 100);
            document.getElementById('territory-coverage').textContent = `${coverage}%`;
        }

        function updateActiveTrails() {
            document.getElementById('active-trails-count').textContent = activeTrails;
        }

        function updateActiveMembers() {
            document.getElementById('active-members').textContent = packMembers.length;
        }

        function logActivity(from, to, type) {
            const activity = {
                from,
                to,
                type,
                timestamp: new Date().toISOString()
            };
            
            activityLog.unshift(activity);
            if (activityLog.length > 50) {
                activityLog.pop();
            }
            
            updateRecentActivity();
        }

        function updateRecentActivity() {
            const container = document.getElementById('recent-activity');
            container.innerHTML = '';
            
            activityLog.slice(0, 10).forEach(activity => {
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between p-2 bg-gray-800/50 rounded-lg';
                
                const typeColors = {
                    'howl': 'text-purple-400',
                    'security': 'text-red-400',
                    'vault': 'text-green-400',
                    'p2p': 'text-blue-400'
                };
                
                item.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <i data-lucide="arrow-right" class="w-4 h-4 text-gray-400"></i>
                        <span class="text-sm">${activity.from}</span>
                        <span class="text-gray-400">â†’</span>
                        <span class="text-sm">${activity.to}</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="text-xs ${typeColors[activity.type]}">${activity.type}</span>
                        <span class="text-xs text-gray-500">${new Date(activity.timestamp).toLocaleTimeString()}</span>
                    </div>
                `;
                
                container.appendChild(item);
            });
            
            // Re-initialize icons
            lucide.createIcons();
        }

        function showMemberDetails(member) {
            alert(`Pack Member: ${member.name}\nRole: ${member.role}\nID: ${member.id}\nStatus: Active`);
        }

        function startRealTimeUpdates() {
            // Simulate real-time traffic
            setInterval(() => {
                if (scentVisualizationEnabled && Math.random() > 0.7) {
                    const fromMember = packMembers[Math.floor(Math.random() * packMembers.length)];
                    const toMember = packMembers[Math.floor(Math.random() * packMembers.length)];
                    const dataTypes = ['howl', 'security', 'vault', 'p2p'];
                    const dataType = dataTypes[Math.floor(Math.random() * dataTypes.length)];
                    
                    if (fromMember.id !== toMember.id) {
                        createScentTrail(fromMember, toMember, dataType);
                        totalMessages++;
                        
                        // Update peak activity
                        const currentActivity = Math.floor(Math.random() * 5) + 1;
                        if (currentActivity > peakActivity) {
                            peakActivity = currentActivity;
                        }
                        
                        updateStatistics();
                    }
                }
            }, 1000);
        }

        function loadRecentActivity() {
            // Load initial mock activity
            for (let i = 0; i < 5; i++) {
                const fromMember = packMembers[Math.floor(Math.random() * packMembers.length)];
                const toMember = packMembers[Math.floor(Math.random() * packMembers.length)];
                const dataTypes = ['howl', 'security', 'vault', 'p2p'];
                const dataType = dataTypes[Math.floor(Math.random() * dataTypes.length)];
                
                if (fromMember.id !== toMember.id) {
                    logActivity(fromMember.name, toMember.name, dataType);
                }
            }
        }

        function updateVisualization() {
            // Update visualization based on checkbox states
            const showHowls = document.getElementById('show-howls').checked;
            const showSecurity = document.getElementById('show-security').checked;
            const showVault = document.getElementById('show-vault').checked;
            const showP2P = document.getElementById('show-p2p').checked;
            
            // Update trail intensity based on selected data types
            const activeTypes = [showHowls, showSecurity, showVault, showP2P].filter(Boolean).length;
            const intensity = activeTypes === 0 ? 'low' : activeTypes <= 2 ? 'medium' : 'high';
            document.getElementById('trail-intensity').textContent = intensity.charAt(0).toUpperCase() + intensity.slice(1);
        }
    </script>
</body>
</html>
