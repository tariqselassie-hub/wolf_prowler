<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wolf Prowler - Timezone Settings</title>
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.tailwindcss.com https://unpkg.com 'unsafe-inline'; style-src 'self' https://cdn.tailwindcss.com 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' http://localhost:8080 https://api.wolfprowler.com; font-src 'self' https: data:;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- External Resources -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        :root {
            --primary: #8b5cf6;
            --primary-dark: #7c3aed;
            --secondary: #4f46e5;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --light: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
        }
        
        body { 
            font-family: 'Inter', sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .glass-morphism {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .timezone-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .timezone-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.15);
        }
        
        .timezone-card.active {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
        }
        
        .clock-display {
            font-family: 'Courier New', monospace;
            font-size: 2rem;
            font-weight: 600;
            letter-spacing: 0.05em;
        }
        
        .nav-item {
            transition: all 0.2s ease;
        }
        
        .nav-item:hover {
            background: rgba(139, 92, 246, 0.1);
            color: #8b5cf6;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="glass-morphism border-b border-gray-700">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-6">
                    <div class="flex items-center space-x-2">
                        <i data-lucide="clock" class="w-6 h-6 text-purple-400"></i>
                        <span class="text-xl font-bold bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">Timezone Settings</span>
                    </div>
                    <div class="hidden md:flex space-x-1">
                        <a href="/nav" class="nav-item px-3 py-2 rounded-lg text-sm">Dashboard</a>
                        <a href="/static/network_map.html" class="nav-item px-3 py-2 rounded-lg text-sm">Network Map</a>
                        <a href="/static/p2p.html" class="nav-item px-3 py-2 rounded-lg text-sm">P2P Chat</a>
                        <a href="/static/wolf_den.html" class="nav-item px-3 py-2 rounded-lg text-sm">Wolf Den</a>
                        <a href="/static/wolf_howl.html" class="nav-item px-3 py-2 rounded-lg text-sm">Wolf Howl</a>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="testTimezoneConversion()" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm transition-colors">
                        <i data-lucide="play" class="w-4 h-4 inline mr-2"></i>Test Conversion
                    </button>
                    <a href="/logout" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm transition-colors">
                        <i data-lucide="log-out" class="w-4 h-4 inline mr-2"></i>Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold mb-2">Timezone Configuration</h1>
            <p class="text-gray-400">Configure timezone preferences and test timestamp conversions</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Current Time Display -->
            <div class="lg:col-span-2">
                <div class="glass-morphism rounded-xl p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i data-lucide="globe" class="w-5 h-5 mr-2 text-purple-400"></i>
                        Current Time Display
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gray-800/50 rounded-lg p-4">
                            <h3 class="text-sm text-gray-400 mb-2">UTC Time</h3>
                            <div id="utc-time" class="clock-display text-green-400">--:--:-- UTC</div>
                            <div id="utc-date" class="text-sm text-gray-400 mt-2">----/--/--</div>
                        </div>
                        
                        <div class="bg-gray-800/50 rounded-lg p-4">
                            <h3 class="text-sm text-gray-400 mb-2">Local Time</h3>
                            <div id="local-time" class="clock-display text-blue-400">--:--:--</div>
                            <div id="local-date" class="text-sm text-gray-400 mt-2">----/--/--</div>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-4 bg-purple-900/20 rounded-lg border border-purple-700/30">
                        <p class="text-sm text-purple-300">
                            <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                            All system timestamps are stored and displayed in UTC by default. Use the settings below to configure local timezone display.
                        </p>
                    </div>
                </div>

                <!-- Timezone Selection -->
                <div class="glass-morphism rounded-xl p-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i data-lucide="settings" class="w-5 h-5 mr-2 text-purple-400"></i>
                        Timezone Selection
                    </h2>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Select Your Timezone</label>
                        <select id="timezone-select" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 focus:outline-none focus:border-purple-500">
                            <option value="UTC">UTC (Coordinated Universal Time)</option>
                            <option value="America/New_York">Eastern Time (ET)</option>
                            <option value="America/Chicago">Central Time (CT)</option>
                            <option value="America/Denver">Mountain Time (MT)</option>
                            <option value="America/Los_Angeles">Pacific Time (PT)</option>
                            <option value="Europe/London">London (GMT/BST)</option>
                            <option value="Europe/Paris">Paris (CET/CEST)</option>
                            <option value="Europe/Berlin">Berlin (CET/CEST)</option>
                            <option value="Asia/Tokyo">Tokyo (JST)</option>
                            <option value="Asia/Shanghai">Shanghai (CST)</option>
                            <option value="Asia/Dubai">Dubai (GST)</option>
                            <option value="Australia/Sydney">Sydney (AEDT/AEST)</option>
                            <option value="Pacific/Auckland">Auckland (NZDT/NZST)</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Time Format</label>
                        <div class="flex space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="time-format" value="24" checked class="mr-2">
                                <span>24-hour (14:30)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="time-format" value="12" class="mr-2">
                                <span>12-hour (2:30 PM)</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="show-timezone" checked class="mr-2">
                            <span>Show timezone abbreviation in timestamps</span>
                        </label>
                    </div>
                    
                    <button onclick="saveTimezoneSettings()" class="w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors">
                        <i data-lucide="save" class="w-4 h-4 inline mr-2"></i>Save Settings
                    </button>
                </div>
            </div>

            <!-- Quick Timezone Cards -->
            <div class="space-y-4">
                <div class="glass-morphism rounded-xl p-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i data-lucide="zap" class="w-5 h-5 mr-2 text-purple-400"></i>
                        Quick Timezones
                    </h2>
                    
                    <div class="space-y-2" id="quick-timezones">
                        <!-- Quick timezone cards will be populated here -->
                    </div>
                </div>

                <!-- Conversion Test -->
                <div class="glass-morphism rounded-xl p-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i data-lucide="refresh-cw" class="w-5 h-5 mr-2 text-purple-400"></i>
                        Test Conversion
                    </h2>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">UTC Timestamp</label>
                        <input type="text" id="test-utc-input" placeholder="2024-01-15 14:30:00 UTC" 
                               class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 focus:outline-none focus:border-purple-500">
                    </div>
                    
                    <button onclick="convertTimestamp()" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors mb-4">
                        <i data-lucide="arrow-right" class="w-4 h-4 inline mr-2"></i>Convert
                    </button>
                    
                    <div id="conversion-result" class="hidden p-4 bg-green-900/20 rounded-lg border border-green-700/30">
                        <p class="text-sm text-green-300" id="conversion-output"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Timestamps -->
        <div class="glass-morphism rounded-xl p-6 mt-6">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <i data-lucide="history" class="w-5 h-5 mr-2 text-purple-400"></i>
                Recent System Timestamps
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="recent-timestamps">
                <!-- Recent timestamps will be populated here -->
            </div>
        </div>
    </main>

    <script>
        // Initialize lucide icons
        lucide.createIcons();

        // Timezone settings
        let timezoneSettings = {
            timezone: localStorage.getItem('wolf_timezone') || 'UTC',
            timeFormat: localStorage.getItem('wolf_time_format') || '24',
            showTimezone: localStorage.getItem('wolf_show_timezone') !== 'false'
        };

        // Quick timezone data
        const quickTimezones = [
            { name: 'New York', tz: 'America/New_York', offset: '-5' },
            { name: 'London', tz: 'Europe/London', offset: '0' },
            { name: 'Tokyo', tz: 'Asia/Tokyo', offset: '+9' },
            { name: 'Sydney', tz: 'Australia/Sydney', offset: '+11' },
            { name: 'Dubai', tz: 'Asia/Dubai', offset: '+4' },
            { name: 'Los Angeles', tz: 'America/Los_Angeles', offset: '-8' }
        ];

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            loadTimezoneSettings();
            updateClocks();
            generateQuickTimezones();
            loadRecentTimestamps();
            
            // Update clocks every second
            setInterval(updateClocks, 1000);
            
            // Load recent timestamps every 30 seconds
            setInterval(loadRecentTimestamps, 30000);
        });

        function loadTimezoneSettings() {
            document.getElementById('timezone-select').value = timezoneSettings.timezone;
            document.querySelector(`input[name="time-format"][value="${timezoneSettings.timeFormat}"]`).checked = true;
            document.getElementById('show-timezone').checked = timezoneSettings.showTimezone;
        }

        function saveTimezoneSettings() {
            timezoneSettings.timezone = document.getElementById('timezone-select').value;
            timezoneSettings.timeFormat = document.querySelector('input[name="time-format"]:checked').value;
            timezoneSettings.showTimezone = document.getElementById('show-timezone').checked;
            
            localStorage.setItem('wolf_timezone', timezoneSettings.timezone);
            localStorage.setItem('wolf_time_format', timezoneSettings.timeFormat);
            localStorage.setItem('wolf_show_timezone', timezoneSettings.showTimezone);
            
            // Update displays
            updateClocks();
            loadRecentTimestamps();
            
            showNotification('Settings saved successfully!', 'success');
        }

        function updateClocks() {
            const now = new Date();
            
            // UTC time
            const utcTime = now.toISOString().slice(11, 19) + ' UTC';
            const utcDate = now.toISOString().slice(0, 10);
            document.getElementById('utc-time').textContent = utcTime;
            document.getElementById('utc-date').textContent = utcDate;
            
            // Local time
            const localTime = formatTimeWithSettings(now);
            const localDate = now.toLocaleDateString();
            document.getElementById('local-time').textContent = localTime;
            document.getElementById('local-date').textContent = localDate;
        }

        function formatTimeWithSettings(date) {
            const options = {
                timeZone: timezoneSettings.timezone,
                hour12: timezoneSettings.timeFormat === '12',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            
            let timeString = date.toLocaleTimeString('en-US', options);
            
            if (timezoneSettings.showTimezone) {
                const tzAbbrev = getTimezoneAbbreviation(timezoneSettings.timezone, date);
                timeString += ' ' + tzAbbrev;
            }
            
            return timeString;
        }

        function getTimezoneAbbreviation(timezone, date) {
            const abbreviations = {
                'UTC': 'UTC',
                'America/New_York': 'ET',
                'America/Chicago': 'CT',
                'America/Denver': 'MT',
                'America/Los_Angeles': 'PT',
                'Europe/London': 'GMT',
                'Europe/Paris': 'CET',
                'Europe/Berlin': 'CET',
                'Asia/Tokyo': 'JST',
                'Asia/Shanghai': 'CST',
                'Asia/Dubai': 'GST',
                'Australia/Sydney': 'AEDT',
                'Pacific/Auckland': 'NZDT'
            };
            
            return abbreviations[timezone] || timezone;
        }

        function generateQuickTimezones() {
            const container = document.getElementById('quick-timezones');
            container.innerHTML = '';
            
            quickTimezones.forEach(tz => {
                const card = document.createElement('div');
                card.className = 'timezone-card glass-morphism rounded-lg p-3 border border-gray-700';
                if (tz.tz === timezoneSettings.timezone) {
                    card.classList.add('active');
                }
                
                const now = new Date();
                const time = now.toLocaleTimeString('en-US', {
                    timeZone: tz.tz,
                    hour12: false,
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                card.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-medium">${tz.name}</div>
                            <div class="text-sm text-gray-400">UTC${tz.offset}</div>
                        </div>
                        <div class="text-lg font-mono">${time}</div>
                    </div>
                `;
                
                card.onclick = () => selectQuickTimezone(tz.tz);
                container.appendChild(card);
            });
        }

        function selectQuickTimezone(timezone) {
            document.getElementById('timezone-select').value = timezone;
            timezoneSettings.timezone = timezone;
            localStorage.setItem('wolf_timezone', timezone);
            generateQuickTimezones();
            updateClocks();
            loadRecentTimestamps();
        }

        function convertTimestamp() {
            const input = document.getElementById('test-utc-input').value;
            const resultDiv = document.getElementById('conversion-result');
            const outputDiv = document.getElementById('conversion-output');
            
            try {
                // Parse the UTC timestamp
                const utcDate = new Date(input.replace(' UTC', ''));
                if (isNaN(utcDate.getTime())) {
                    throw new Error('Invalid timestamp format');
                }
                
                // Convert to selected timezone
                const convertedTime = formatTimeWithSettings(utcDate);
                const convertedDate = utcDate.toLocaleDateString('en-US', {
                    timeZone: timezoneSettings.timezone
                });
                
                outputDiv.innerHTML = `
                    <strong>Converted Time:</strong> ${convertedDate} ${convertedTime}<br>
                    <strong>Original UTC:</strong> ${input}
                `;
                
                resultDiv.classList.remove('hidden');
            } catch (error) {
                outputDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
                resultDiv.classList.remove('hidden');
            }
        }

        function testTimezoneConversion() {
            // Generate test timestamps
            const testTimestamps = [
                '2024-01-15 14:30:00 UTC',
                '2024-06-15 08:45:00 UTC',
                '2024-12-25 23:59:00 UTC'
            ];
            
            testTimestamps.forEach(ts => {
                document.getElementById('test-utc-input').value = ts;
                convertTimestamp();
            });
        }

        async function loadRecentTimestamps() {
            try {
                // Mock recent timestamps - in real implementation, this would fetch from API
                const mockTimestamps = [
                    { event: 'Peer Connected', timestamp: new Date(Date.now() - 5000).toISOString() },
                    { event: 'Security Alert', timestamp: new Date(Date.now() - 15000).toISOString() },
                    { event: 'Message Sent', timestamp: new Date(Date.now() - 30000).toISOString() },
                    { event: 'System Update', timestamp: new Date(Date.now() - 60000).toISOString() },
                    { event: 'Network Scan', timestamp: new Date(Date.now() - 120000).toISOString() },
                    { event: 'Vault Access', timestamp: new Date(Date.now() - 180000).toISOString() }
                ];
                
                const container = document.getElementById('recent-timestamps');
                container.innerHTML = '';
                
                mockTimestamps.forEach(item => {
                    const date = new Date(item.timestamp);
                    const card = document.createElement('div');
                    card.className = 'bg-gray-800/50 rounded-lg p-3';
                    
                    card.innerHTML = `
                        <div class="text-sm font-medium">${item.event}</div>
                        <div class="text-xs text-gray-400">UTC: ${date.toISOString().slice(0, 19).replace('T', ' ')} UTC</div>
                        <div class="text-xs text-purple-400">Local: ${formatTimeWithSettings(date)}</div>
                    `;
                    
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('Failed to load recent timestamps:', error);
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg glass-morphism z-50 ${
                type === 'success' ? 'border-green-500' : 
                type === 'error' ? 'border-red-500' : 'border-blue-500'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i data-lucide="${type === 'success' ? 'check-circle' : 'info'}" class="w-5 h-5 mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            lucide.createIcons();
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>
